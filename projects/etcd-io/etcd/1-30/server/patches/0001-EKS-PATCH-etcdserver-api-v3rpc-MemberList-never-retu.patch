From f114c34e123bdaf38256dcbcc8d7f8ece5605da5 Mon Sep 17 00:00:00 2001
From: Gyuho Lee <leegyuho@amazon.com>
Date: Thu, 16 Jul 2020 16:20:50 -0700
Subject: [PATCH 1/2] --EKS-PATCH-- etcdserver/api/v3rpc: "MemberList" never
 return non-empty ClientURLs

Signed-off-by: Gyuho Lee <leegyuho@amazon.com>
---
 server/etcdserver/api/v3rpc/member.go | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/server/etcdserver/api/v3rpc/member.go b/server/etcdserver/api/v3rpc/member.go
index 54fcc2484..3d84c091d 100644
--- a/server/etcdserver/api/v3rpc/member.go
+++ b/server/etcdserver/api/v3rpc/member.go
@@ -16,6 +16,8 @@ package v3rpc
 
 import (
 	"context"
+	"fmt"
+	"os"
 	"time"
 
 	pb "go.etcd.io/etcd/api/v3/etcdserverpb"
@@ -94,6 +96,19 @@ func (cs *ClusterServer) MemberList(ctx context.Context, r *pb.MemberListRequest
 		}
 	}
 	membs := membersToProtoMembers(cs.cluster.Members())
+	for idx := range membs {
+		mv := membs[idx]
+		if len(mv.ClientURLs) == 0 {
+			mv.ClientURLs = []string{"invalid"}
+			fmt.Fprintf(os.Stderr, "[leegyuho-test] member %x (name %q) has empty ClientURLs, adding placeholder value [ClientURLs %q, PeerURLs %q]\n",
+				mv.ID,
+				mv.Name,
+				mv.ClientURLs,
+				mv.PeerURLs,
+			)
+		}
+		membs[idx] = mv
+	}
 	return &pb.MemberListResponse{Header: cs.header(), Members: membs}, nil
 }
 
-- 
2.41.0

